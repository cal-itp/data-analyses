## Download Single Day of GTFS Schedule & Real-Time Data

Use `update_vars` and input one or several days to download. 

1. **Schedule data**: download data for [trips](./download_trips.py), [stops](./download_stops.py), [shapes](./download_shapes.py), and [stop times](./download_stop_times.py) and cache parquets in GCS
1. **Vehicle positions data**: download [RT vehicle positions](./download_vehicle_positions.py)
1. Use the [Makefile](./Makefile) and download schedule and RT data. In terminal: `make download_gtfs_data`
1. Other preprocessing steps for schedule and vp: `make preprocess_schedule_vp_dependency` and `make preprocess_vp`, `make preprocess_schedule_only`
   * Preprocessing batches are grouped in a somewhat modular way to clarify schedule only and vp only preprocessing steps so the two large workstreams move independently.
   * The `make preprocess_schedule_vp_dependency` call out specific preprocessing steps where RT data depends on schedule preprocessing (such as shared crosswalks and additional `stop_times` transformations).
1. Harmonize how route names are displayed in time-series: `make timeseries_preprocessing` 
1. Download monthly aggregated schedule data: `make monthly_scheduled_data`


[![gtfs_funnel_mermaid1](https://mermaid.ink/img/pako:eNqllW9v2jAQxr-K5QlBJWCEhJamW6VSSF9tmlS0SQtVZJILsWrsyHZKadXvPicpJLQFNu0FSYh_z92T8597xqGIALu40-nMuKaagYtupt4t8jLOgaHWDwmpFCEoRfniZMYLsNF4nnGEKKfaRcUjQk2dwBKaLmrOiYJmu_72J5GUzBmo5hY3Q6mkSyLX14IJmes-TQbewLvaSCtiCo-6onq93ntkJGQEch_EKId9YwpCwaNdH553NhnVGA1S0x0kjuNmOfyS38zlpdGY8RlfSJImaDoqB8uryubl60isOBPEON2ERihkRKkxxCiKUUwZc1_L8AGhQklTvaEKk3nKDXdltfxNhkAbVHXT9d2J67qvwk7nElV4IfEL7s4wJv378QRYClJ16TIVUgcqTCDKGLyGv6jgUT23SkgKx5OP_BL8MpeXv25uh86_2ygD1HxcWzUbWpQlOGTi2i-w__GQ62sWxjulMIOBpsu_KMfYr-C9LsZ9_6CRUr6rWVGdBBGVEGoqOPqKpjKDzx5hCu5qvid13w-Q0JBBkApFc9Vx-5N-yzc7KSQauPkdjbCrzuNN_If0zTxcbNY38GjzuN1N1fcGaf2Uqk3FG59ju1UrcrBbmINfOO4ftPKQ7rMwKT_NJDbMPUAaZCo_Co_X0ykk0QoYK_weVXg5X0YvZXtX0WRg5ooB4Vm6G7W2HLxC51mFi_yIBK5AHjfRz3kORILS5k4XyVzIfFq_X42H9nZaq9Pxo3oKs8KJFjIIpVBqRdh97Zj7IOuNsblFg4WOVRARbfqQNjVfB1oEQi4Ip0_kg5l-vxJv_CJELq3r0DbF-9WJ23gJckloZLpp0eNmuOh9M-yaxwhikjE9w6ZRGJRkWtyueYhdbfZiG0uRLRLsxvmebOMsNeZhTIkpxnL7NiX8txDVf4ioqdC3sn8XbbxgsPuMH7HbGfa79rndP3fss6F93recNl5j1z7tWs5g6Jw6jjXoDR3rpY2fiqhWt2-Zztizzmzb0M6Z8_IHVGx2Qw?type=png)](https://mermaid.live/edit#pako:eNqllW9v2jAQxr-K5QlBJWCEhJamW6VSSF9tmlS0SQtVZJILsWrsyHZKadXvPicpJLQFNu0FSYh_z92T8597xqGIALu40-nMuKaagYtupt4t8jLOgaHWDwmpFCEoRfniZMYLsNF4nnGEKKfaRcUjQk2dwBKaLmrOiYJmu_72J5GUzBmo5hY3Q6mkSyLX14IJmes-TQbewLvaSCtiCo-6onq93ntkJGQEch_EKId9YwpCwaNdH553NhnVGA1S0x0kjuNmOfyS38zlpdGY8RlfSJImaDoqB8uryubl60isOBPEON2ERihkRKkxxCiKUUwZc1_L8AGhQklTvaEKk3nKDXdltfxNhkAbVHXT9d2J67qvwk7nElV4IfEL7s4wJv378QRYClJ16TIVUgcqTCDKGLyGv6jgUT23SkgKx5OP_BL8MpeXv25uh86_2ygD1HxcWzUbWpQlOGTi2i-w__GQ62sWxjulMIOBpsu_KMfYr-C9LsZ9_6CRUr6rWVGdBBGVEGoqOPqKpjKDzx5hCu5qvid13w-Q0JBBkApFc9Vx-5N-yzc7KSQauPkdjbCrzuNN_If0zTxcbNY38GjzuN1N1fcGaf2Uqk3FG59ju1UrcrBbmINfOO4ftPKQ7rMwKT_NJDbMPUAaZCo_Co_X0ykk0QoYK_weVXg5X0YvZXtX0WRg5ooB4Vm6G7W2HLxC51mFi_yIBK5AHjfRz3kORILS5k4XyVzIfFq_X42H9nZaq9Pxo3oKs8KJFjIIpVBqRdh97Zj7IOuNsblFg4WOVRARbfqQNjVfB1oEQi4Ip0_kg5l-vxJv_CJELq3r0DbF-9WJ23gJckloZLpp0eNmuOh9M-yaxwhikjE9w6ZRGJRkWtyueYhdbfZiG0uRLRLsxvmebOMsNeZhTIkpxnL7NiX8txDVf4ioqdC3sn8XbbxgsPuMH7HbGfa79rndP3fss6F93recNl5j1z7tWs5g6Jw6jjXoDR3rpY2fiqhWt2-Zztizzmzb0M6Z8_IHVGx2Qw)


[![speeds_stop_times_mermaid](https://mermaid.ink/img/pako:eNqlVV1v2jAU_SuWJwSTgPERCqTapEJh07buYUV7WEDITW7AmmNHttOWVvz3OU5YkkK7Lx7A-J577_Hxsf2IfREAdnGr1VpyTTUDF31doGvYRMA1uo4BAoUID-ysFjFa0AjUktuEWu1xyRGinGoX2SFCdb2FCOouqt8QBfVmefYbkZTcMFD1X3ATiiWNiNxNBRMyzXs1G8wH84tDaoFYwL0uUJ1O5xgyETIA-RyIUQ7PxRT4ggdVHvP5cDYpYTRITSuQMAzrWXif_pivfa225EseMnHnb4nUaDHJACq52UgSb5HKxKUPcCiMkM-IUpcQoiBEIWXMzUU4gVC-pLE-oCzFU6isyWIXQw6dT-f98bSJlJbiB7gp9ZToIfOi2_D8RK-V2eR1nq3a8W712nXdvGerhYqE9EMYQ9qEkM3SqTUM6N0T1IVXKboyBYPwvMBMTGsFDPy_6C44ZJ1jkEhtSQx1VWJRAJXIpmNCpXGyBGT2WVGlU38XMOJLoZQtaZdQYufZ8lVqq_OydtkIeHCYLPbaHqB1TGNIzVdOmjY8DoaP0utbw1rYBkdLfqrlZcOj3PgwFozonBSRkt4S9tvcWcMr45VtmhKsZp6jA82TK0ovgVyGfHlFl3kjj6y1Md7bimS2QcmVx_ymJU_MbPx9wyO3IMkGDmUywsfWKG3YB08KxhLTmfINg4Ds3uQTUcI0Nf9L7sj2R4rEiBlQ-YJJM0Ivi2MuyVMe_FiVReY-t6h_keVTSZYkSu-9P5Dl83_IsipRuPIK8us7qrcpwJxdKvjKsps9WcMXT_lbCBIG68rKizOUS4mbOAIZERqYF8m-D0ts340lds0wgJAYpktsLlkDJYkW1zvuY1fLBJo4iQNzIi4pMVsRYTc0BjezEFAt5FX2ytnHroljwrH7iO-x2xr12v1xvzd2-sNRf9zrOk28w27_rN11BiPnzHG6g87I6e6b-EEIU7Xb7nXNu9HpDvt9g3aGji333QZty_1PICdHvQ?type=png)](https://mermaid.live/edit#pako:eNqlVV1v2jAU_SuWJwSTgPERCqTapEJh07buYUV7WEDITW7AmmNHttOWVvz3OU5YkkK7Lx7A-J577_Hxsf2IfREAdnGr1VpyTTUDF31doGvYRMA1uo4BAoUID-ysFjFa0AjUktuEWu1xyRGinGoX2SFCdb2FCOouqt8QBfVmefYbkZTcMFD1X3ATiiWNiNxNBRMyzXs1G8wH84tDaoFYwL0uUJ1O5xgyETIA-RyIUQ7PxRT4ggdVHvP5cDYpYTRITSuQMAzrWXif_pivfa225EseMnHnb4nUaDHJACq52UgSb5HKxKUPcCiMkM-IUpcQoiBEIWXMzUU4gVC-pLE-oCzFU6isyWIXQw6dT-f98bSJlJbiB7gp9ZToIfOi2_D8RK-V2eR1nq3a8W712nXdvGerhYqE9EMYQ9qEkM3SqTUM6N0T1IVXKboyBYPwvMBMTGsFDPy_6C44ZJ1jkEhtSQx1VWJRAJXIpmNCpXGyBGT2WVGlU38XMOJLoZQtaZdQYufZ8lVqq_OydtkIeHCYLPbaHqB1TGNIzVdOmjY8DoaP0utbw1rYBkdLfqrlZcOj3PgwFozonBSRkt4S9tvcWcMr45VtmhKsZp6jA82TK0ovgVyGfHlFl3kjj6y1Md7bimS2QcmVx_ymJU_MbPx9wyO3IMkGDmUywsfWKG3YB08KxhLTmfINg4Ds3uQTUcI0Nf9L7sj2R4rEiBlQ-YJJM0Ivi2MuyVMe_FiVReY-t6h_keVTSZYkSu-9P5Dl83_IsipRuPIK8us7qrcpwJxdKvjKsps9WcMXT_lbCBIG68rKizOUS4mbOAIZERqYF8m-D0ts340lds0wgJAYpktsLlkDJYkW1zvuY1fLBJo4iQNzIi4pMVsRYTc0BjezEFAt5FX2ytnHroljwrH7iO-x2xr12v1xvzd2-sNRf9zrOk28w27_rN11BiPnzHG6g87I6e6b-EEIU7Xb7nXNu9HpDvt9g3aGji333QZty_1PICdHvQ)

[![rt_vs_sched_mermaid](https://mermaid.ink/img/pako:eNqFVG1vmzAQ_iuWpyidlEQhIU1KpUlNm2zqlnZao30YVMiBA7yCjWzTllb57zNQCqjNygewfM9z99wL94w97gO28HA4dJiiKgYL_dqie4luvAj8LAa0ASWoJx1WYnq9Z4chRBlVFiqPCPVVBAn0LdTfEQn9Qfv2NxGU7GKQ_Ve4NqWCJkTk5zzmouB9Ws3Ws_VZTW0QW3hUDWo8Hr-FLLnwQRwCxZTBIZsEjzO_q2O9nq-WLYwCoWgHEgRBvzLvi49-7Xs9hzksiPmDFxGh0HZZAWS2CwVJIyRfilm7RciLiZQXECA_QAGNY-ulBO8gpCdoqmpUKbAIV-PObN2fVN5alqV9DYdfUGMrntWRzVMQRHHh1jp8Vyqi5CjNbz9rXhXhtOEtbRmRFNpOVy3zuS0VTw9ZL0qrq2hy0MHaDlUg3TvIXS5CwugTUZQz1xNcygcS33V4rYRW5dUPu04EFbmjpBrRVxIiYSggJAreqcemIQueKXB9KsArwnf9nNZFBubXx9eGXp2db68rPlJ5qocjpCBbNShUyFRnRWL0l1OGFEe7LAhAgK95xJfvSPtqFxZXQpgAU4db-u3IrqQ3obutLDhdyqVdBX2gKmopbkrWhXekl5yYsxCkQuVgID1QL9m_ifS90taJlDepbE4R-l9l7yGinu5NyiUtmiLbs35l36duJouFcrA41xrz4Vh0KYWTnwXto4GoCS359RUe4AREQqiv12m56RxcbkAHW_roQ0CyWDlYrwsNJZniNznzsKVEBgOcpb6WdUGJLkKCrYDEUt-CT_Vfu6lWdLmpBzglDFvP-BFbw8VkND2ZTk7M6XwxPZkY5gDn2JoejwxztjCPTdOYjRemsR_gJ861V2M0MfQGHBvz6VSjzblZuvtTGsuQ-39p7tDM?type=png)](https://mermaid.live/edit#pako:eNqFVG1vmzAQ_iuWpyidlEQhIU1KpUlNm2zqlnZao30YVMiBA7yCjWzTllb57zNQCqjNygewfM9z99wL94w97gO28HA4dJiiKgYL_dqie4luvAj8LAa0ASWoJx1WYnq9Z4chRBlVFiqPCPVVBAn0LdTfEQn9Qfv2NxGU7GKQ_Ve4NqWCJkTk5zzmouB9Ws3Ws_VZTW0QW3hUDWo8Hr-FLLnwQRwCxZTBIZsEjzO_q2O9nq-WLYwCoWgHEgRBvzLvi49-7Xs9hzksiPmDFxGh0HZZAWS2CwVJIyRfilm7RciLiZQXECA_QAGNY-ulBO8gpCdoqmpUKbAIV-PObN2fVN5alqV9DYdfUGMrntWRzVMQRHHh1jp8Vyqi5CjNbz9rXhXhtOEtbRmRFNpOVy3zuS0VTw9ZL0qrq2hy0MHaDlUg3TvIXS5CwugTUZQz1xNcygcS33V4rYRW5dUPu04EFbmjpBrRVxIiYSggJAreqcemIQueKXB9KsArwnf9nNZFBubXx9eGXp2db68rPlJ5qocjpCBbNShUyFRnRWL0l1OGFEe7LAhAgK95xJfvSPtqFxZXQpgAU4db-u3IrqQ3obutLDhdyqVdBX2gKmopbkrWhXekl5yYsxCkQuVgID1QL9m_ifS90taJlDepbE4R-l9l7yGinu5NyiUtmiLbs35l36duJouFcrA41xrz4Vh0KYWTnwXto4GoCS359RUe4AREQqiv12m56RxcbkAHW_roQ0CyWDlYrwsNJZniNznzsKVEBgOcpb6WdUGJLkKCrYDEUt-CT_Vfu6lWdLmpBzglDFvP-BFbw8VkND2ZTk7M6XwxPZkY5gDn2JoejwxztjCPTdOYjRemsR_gJ861V2M0MfQGHBvz6VSjzblZuvtTGsuQ-39p7tDM)

## Analytic Grains
[![mermaid_grains](https://mermaid.ink/img/pako:eNqNVttu4zYQ_RWCReAUsAJJtmtHDwWSdeQ-tECRDYqgsrGgxZFNVCJVksquN8i_lxTlmPKlWT_YFufMmTPD4VCvOBcUcIKDIFhyzXQJCVo8pZ_RHSflTrNcoT9ZDSXjgBaSMK6WvMVeXb0uOUKMM52g9i9CA72FCgYJGqyJgsHQX_2LSEbWJajBO9yYaskqInefRCmk9fvpYZJO0ru96wHxBN_0ARWG4SnkXkgK8hLIZnDJpiAXnPZ1pOn04d7DaJCa9SBFUQyc-c3-mK-3q6slX_KiFF_zLZEa_f7oAHlJlJpDgSTkGhWsLJMu0yN7zmRewh7RajjDEHeA9DYNH2Ib0kJUs95IUm-RYnxjSCjZOcM-B4TuMpVvgTYlrFAQ_IruokyKRkNAmeVlgq88sIPEmahBEi1k33ZjjaNMaVGv9hLs5z57gS2zWdRCMcupXLD7KFOwqYBrpGoAqg4-RyKCDtfnjToWcp2pLakhsKFRB_XI7PKX_fLq5yRJuqr6XKQl-xSRjLyY7DbwsSZLWxMmV4ax3YUD9ozK9XVGyhJpyepLQh-fWq1Iswp8oT7butO5znw00vYo_ZiQ3JTLplaRgwYPF_1TXQidd6HzoxKhD_ftC6OetjOa6LXpO0LP1CRCF_XQTg-9uGX2jJsxQ4NKF3n-rkbBvw3w_IN6OWmmoZvKTpMPk135znFve9TR_nTUfinm1uFFof55nP_feZw7SOyOnHsYHdH4DeXL69B7BcDpydSwTqZkkoHyhaZnFHnWljiNskpwvY0CM3MiJ-3RtJ0mdqpS9h1c8RAnlzq9I4odUewT-fEeHWx0LKqv_tBMlJioZnyhlvZsUy7OzbeFm2-LKLMH2ApBZLORsLF8Wji6VstidOoVn9Tsxwnala6cXoe5sriK_PauGNVSmKsAThI7t8EthZ_589Ft8Nx1n1eHZ2fo3QFeBITwEFcgK8KoeYlo7_Ulbu_7JU7MXwoFaUq9xOZyNFDSaPF5x3OcaNnAEJtwmy1OClIq89TUdrvmjBi91ftqTfjfQvSecfKKv-FkEt6MJ-PpLJrFt-E0vp0O8Q4ncRzdjEaTX6bhZDqehrPJ2xB_bwnM-ng6uh3P4nEYz8JoEg0xUGay-sO9BLXvQm__Ae0gtOI?type=png)](https://mermaid.live/edit#pako:eNqNVttu4zYQ_RWCReAUsAJJtmtHDwWSdeQ-tECRDYqgsrGgxZFNVCJVksquN8i_lxTlmPKlWT_YFufMmTPD4VCvOBcUcIKDIFhyzXQJCVo8pZ_RHSflTrNcoT9ZDSXjgBaSMK6WvMVeXb0uOUKMM52g9i9CA72FCgYJGqyJgsHQX_2LSEbWJajBO9yYaskqInefRCmk9fvpYZJO0ru96wHxBN_0ARWG4SnkXkgK8hLIZnDJpiAXnPZ1pOn04d7DaJCa9SBFUQyc-c3-mK-3q6slX_KiFF_zLZEa_f7oAHlJlJpDgSTkGhWsLJMu0yN7zmRewh7RajjDEHeA9DYNH2Ib0kJUs95IUm-RYnxjSCjZOcM-B4TuMpVvgTYlrFAQ_IruokyKRkNAmeVlgq88sIPEmahBEi1k33ZjjaNMaVGv9hLs5z57gS2zWdRCMcupXLD7KFOwqYBrpGoAqg4-RyKCDtfnjToWcp2pLakhsKFRB_XI7PKX_fLq5yRJuqr6XKQl-xSRjLyY7DbwsSZLWxMmV4ax3YUD9ozK9XVGyhJpyepLQh-fWq1Iswp8oT7butO5znw00vYo_ZiQ3JTLplaRgwYPF_1TXQidd6HzoxKhD_ftC6OetjOa6LXpO0LP1CRCF_XQTg-9uGX2jJsxQ4NKF3n-rkbBvw3w_IN6OWmmoZvKTpMPk135znFve9TR_nTUfinm1uFFof55nP_feZw7SOyOnHsYHdH4DeXL69B7BcDpydSwTqZkkoHyhaZnFHnWljiNskpwvY0CM3MiJ-3RtJ0mdqpS9h1c8RAnlzq9I4odUewT-fEeHWx0LKqv_tBMlJioZnyhlvZsUy7OzbeFm2-LKLMH2ApBZLORsLF8Wji6VstidOoVn9Tsxwnala6cXoe5sriK_PauGNVSmKsAThI7t8EthZ_589Ft8Nx1n1eHZ2fo3QFeBITwEFcgK8KoeYlo7_Ulbu_7JU7MXwoFaUq9xOZyNFDSaPF5x3OcaNnAEJtwmy1OClIq89TUdrvmjBi91ftqTfjfQvSecfKKv-FkEt6MJ-PpLJrFt-E0vp0O8Q4ncRzdjEaTX6bhZDqehrPJ2xB_bwnM-ng6uh3P4nEYz8JoEg0xUGay-sO9BLXvQm__Ae0gtOI)


|  |  | pipeline and workstream outputs available |
|---|---|---|
| Sampled Wednesdays Each Month for Time-Series<br>[rt_dates.py](../_shared_utils/shared_utils/rt_dates.py) | Mar 2023 - present | downloaded schedule tables (trips, shapes, stops, stop_times)<br>downloaded vehicle positions (vp)<br><br>`gtfs_funnel`: intermediate outputs for schedule and vp<br>* crosswalk<br>* schedule only metrics related to service availability<br>* operator aggregated metrics from schedule data<br>* route typologies<br><br><br>`rt_segment_speeds`: vp interpreted as speeds against <br>various segment types<br>* segment types: <br>(1) `stop segments` (shape-stop segments,<br>most common shape selected for a route-direction and all <br>trips aggregated to that shape)<br>(2) `rt_stop_times` (trip-stop segments, most granular, <br>cannot be aggregated, but used for rt_stop_times table)<br>(3) `speedmap segments`<br>(4) `road segments` (1 km road segments with all <br>transit across operators aggregated to the same physical <br>road space, currently WIP)<br>* interpolated stop arrivals <br>* speeds by trip<br>* segment and summary speeds for single day<br><br>`rt_vs_schedule`: <br>* RT vs schedule metrics<br>* rt_stop_times table (companion to scheduled stop_times)<br><br>`gtfs_digest`:<br>* downstream data product using all the outputs created in <br>gtfs_funnel, rt_segment_speeds, rt_vs_schedule. |
| Full Week for Weekly Averages<br>April / October each year | Apr 2023<br>Oct 2023<br>Apr 2024 | rt_segment_speeds:<br>* segment and summary speeds for a week<br><br>gtfs_digest<br>* service hours by hour for weekday / Saturday / Sunday |
|  |  |  |