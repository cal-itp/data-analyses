## Download Single Day of GTFS Schedule & Real-Time Data

Use `update_vars` and input one or several days to download. 

1. **Schedule data**: download data for [trips](./download_trips.py), [stops](./download_stops.py), [shapes](./download_shapes.py), and [stop times](./download_stop_times.py) and cache parquets in GCS
1. **Vehicle positions data**: download [RT vehicle positions](./download_vehicle_positions.py)
1. Use the [Makefile](./Makefile) and download schedule and RT data. In terminal: `make download_gtfs_data`
1. Other preprocessing steps for schedule and vp: `make preprocess_schedule_vp_dependency` and `make preprocess_vp`, `make preprocess_schedule_only`
   * Preprocessing batches are grouped in a somewhat modular way to clarify schedule only and vp only preprocessing steps so the two large workstreams move independently.
   * The `make preprocess_schedule_vp_dependency` call out specific preprocessing steps where RT data depends on schedule preprocessing (such as shared crosswalks and additional `stop_times` transformations).
1. Harmonize how route names are displayed in time-series: `make timeseries_preprocessing` 
1. Download monthly aggregated schedule data: `make monthly_scheduled_data`
1. Datasets are catalogued in [gtfs_analytics_data.yml](https://github.com/cal-itp/data-analyses/blob/main/_shared_utils/shared_utils/gtfs_analytics_data.yml).

### Is it a New Calendar Year?

Be sure to create a line in `shared_utils/rt_dates` for the new year, such as: `y2025_dates = [v for k, v in DATES.items() if k.endswith("2025")]`. Then increment this argument to `time_series_utils.concatenate_datasets_across_dates` in `track_publish_dates.py` to include the new and previous year: `rt_dates.y2025_dates + rt_dates.y2024_dates`. Running `track_publish_dates.py` without doing this will produce an error. 


[![gtfs_funnel_mermaid](https://mermaid.ink/img/pako:eNqllW9v2jAQxr-K5QlBJWCEhJamW6VSSF9tmlS0SQtVZJILsWrsyHZKadXvPicpJLQFNu0FSYh_z92T8597xqGIALu40-nMuKaagYtupt4t8jLOgaHWDwmpFCEoRfniZMYLsNF4nnGEKKfaRcUjQk2dwBKaLmrOiYJmu_72J5GUzBmo5hY3Q6mkSyLX14IJmes-TQbewLvaSCtiCo-6onq93ntkJGQEch_EKId9YwpCwaNdH553NhnVGA1S0x0kjuNmOfyS38zlpdGY8RlfSJImaDoqB8uryubl60isOBPEON2ERihkRKkxxCiKUUwZc1_L8AGhQklTvaEKk3nKDXdltfxNhkAbVHXT9d2J67qvwk7nElV4IfEL7s4wJv378QRYClJ16TIVUgcqTCDKGLyGv6jgUT23SkgKx5OP_BL8MpeXv25uh86_2ygD1HxcWzUbWpQlOGTi2i-w__GQ62sWxjulMIOBpsu_KMfYr-C9LsZ9_6CRUr6rWVGdBBGVEGoqOPqKpjKDzx5hCu5qvid13w-Q0JBBkApFc9Vx-5N-yzc7KSQauPkdjbCrzuNN_If0zTxcbNY38GjzuN1N1fcGaf2Uqk3FG59ju1UrcrBbmINfOO4ftPKQ7rMwKT_NJDbMPUAaZCo_Co_X0ykk0QoYK_weVXg5X0YvZXtX0WRg5ooB4Vm6G7W2HLxC51mFi_yIBK5AHjfRz3kORILS5k4XyVzIfFq_X42H9nZaq9Pxo3oKs8KJFjIIpVBqRdh97Zj7IOuNsblFg4WOVRARbfqQNjVfB1oEQi4Ip0_kg5l-vxJv_CJELq3r0DbF-9WJ23gJckloZLpp0eNmuOh9M-yaxwhikjE9w6ZRGJRkWtyueYhdbfZiG0uRLRLsxvmebOMsNeZhTIkpxnL7NiX8txDVf4ioqdC3sn8XbbxgsPuMH7HbGfa79rndP3fss6F93recNl5j1z7tWs5g6Jw6jjXoDR3rpY2fiqhWt2-Zztizzmzb0M6Z8_IHVGx2Qw?type=png)](https://mermaid.live/edit#pako:eNqllW9v2jAQxr-K5QlBJWCEhJamW6VSSF9tmlS0SQtVZJILsWrsyHZKadXvPicpJLQFNu0FSYh_z92T8597xqGIALu40-nMuKaagYtupt4t8jLOgaHWDwmpFCEoRfniZMYLsNF4nnGEKKfaRcUjQk2dwBKaLmrOiYJmu_72J5GUzBmo5hY3Q6mkSyLX14IJmes-TQbewLvaSCtiCo-6onq93ntkJGQEch_EKId9YwpCwaNdH553NhnVGA1S0x0kjuNmOfyS38zlpdGY8RlfSJImaDoqB8uryubl60isOBPEON2ERihkRKkxxCiKUUwZc1_L8AGhQklTvaEKk3nKDXdltfxNhkAbVHXT9d2J67qvwk7nElV4IfEL7s4wJv378QRYClJ16TIVUgcqTCDKGLyGv6jgUT23SkgKx5OP_BL8MpeXv25uh86_2ygD1HxcWzUbWpQlOGTi2i-w__GQ62sWxjulMIOBpsu_KMfYr-C9LsZ9_6CRUr6rWVGdBBGVEGoqOPqKpjKDzx5hCu5qvid13w-Q0JBBkApFc9Vx-5N-yzc7KSQauPkdjbCrzuNN_If0zTxcbNY38GjzuN1N1fcGaf2Uqk3FG59ju1UrcrBbmINfOO4ftPKQ7rMwKT_NJDbMPUAaZCo_Co_X0ykk0QoYK_weVXg5X0YvZXtX0WRg5ooB4Vm6G7W2HLxC51mFi_yIBK5AHjfRz3kORILS5k4XyVzIfFq_X42H9nZaq9Pxo3oKs8KJFjIIpVBqRdh97Zj7IOuNsblFg4WOVRARbfqQNjVfB1oEQi4Ip0_kg5l-vxJv_CJELq3r0DbF-9WJ23gJckloZLpp0eNmuOh9M-yaxwhikjE9w6ZRGJRkWtyueYhdbfZiG0uRLRLsxvmebOMsNeZhTIkpxnL7NiX8txDVf4ioqdC3sn8XbbxgsPuMH7HbGfa79rndP3fss6F93recNl5j1z7tWs5g6Jw6jjXoDR3rpY2fiqhWt2-Zztizzmzb0M6Z8_IHVGx2Qw)

[![speeds_stop_times_mermaid](https://mermaid.ink/img/pako:eNqVVV1v2jAU_SuWJwSbgEGAQoI2qaWwaVv3sKI9LKDIJDdgzbEj22lLK_77HCc0fLSbxkOwfc-599yPOE84FBFgD7darQXXVDPw0I85uoV1Alyj2xQgUojwyJ5qkaI5TUAtuCXUak8LjhDlVHvILhGq6w0kUPdQfUUU1JuHpz-JpGTFQNWf4caUSpoQuZ0IJmTOezMdzAazyz21QszhQVeoTqdzDrkSMgL5GohRDq_ZFISCR8c6ZrPh9OoAo0FqegSJ47hemHf5n3nsarUFX_CYiftwQ6RG86sCoLLVWpJ0g1RRXPoIe8cIhYwodQ0ximIUU8a8sggvIFQoaar3KCvxJVQRZL5NoYTOJrOeO2kipaX4DV4uPRe6Z152G36Y6UCZJgclW7XT7fKt53llzFYLVYT8RxhD2piQZel8NAzo4wnq0j9yujQOo3h8GLxYAY_2h1Wx7AQGKU0h794hadLwORAJSgd3Jriw0s8Un4q5bviUm0amghENRbpESnpH2D-504Z_iFc2aC7wmDlGe5kvZlS-W0VmVYCpDfjJhChSXm1tQQMRBxHZnmurmJ99KRjLTIUpXzMw6PflQZIxTc2-wpbO31nfIja28748961Q9Pd0zL1QNb_ifmmUbgNtRvCDLAerGBEhCx0JqabCJncwtOfVn4xPi_W14ZM7kGRt-pgl-ftftEP9rVrf_r9aUmRmVCIqlwcSbvwqo-Ce6k0OgFBTwZdW3fQkh---CjcQZQyCo3Isxyf1xU2cgEwIjczNbO_JBbb35wJ7ZhlBTIzSBTaXjYGSTIvbLQ-xp2UGTWzErjfYi818ml2WRmbMrykx3UqeT1PCfwlR7SGiWsib4ltgPwkWg70n_IC9ltN1291Rp9N3-n1n1O31nCbeYq_bbztu72I0HAwcp2fMvV0TP1q_3XbXHTru8MJ1HHc0GrnO7g92VP_S?type=png)](https://mermaid.live/edit#pako:eNqVVV1v2jAU_SuWJwSbgEGAQoI2qaWwaVv3sKI9LKDIJDdgzbEj22lLK_77HCc0fLSbxkOwfc-599yPOE84FBFgD7darQXXVDPw0I85uoV1Alyj2xQgUojwyJ5qkaI5TUAtuCXUak8LjhDlVHvILhGq6w0kUPdQfUUU1JuHpz-JpGTFQNWf4caUSpoQuZ0IJmTOezMdzAazyz21QszhQVeoTqdzDrkSMgL5GohRDq_ZFISCR8c6ZrPh9OoAo0FqegSJ47hemHf5n3nsarUFX_CYiftwQ6RG86sCoLLVWpJ0g1RRXPoIe8cIhYwodQ0ximIUU8a8sggvIFQoaar3KCvxJVQRZL5NoYTOJrOeO2kipaX4DV4uPRe6Z152G36Y6UCZJgclW7XT7fKt53llzFYLVYT8RxhD2piQZel8NAzo4wnq0j9yujQOo3h8GLxYAY_2h1Wx7AQGKU0h794hadLwORAJSgd3Jriw0s8Un4q5bviUm0amghENRbpESnpH2D-504Z_iFc2aC7wmDlGe5kvZlS-W0VmVYCpDfjJhChSXm1tQQMRBxHZnmurmJ99KRjLTIUpXzMw6PflQZIxTc2-wpbO31nfIja28748961Q9Pd0zL1QNb_ifmmUbgNtRvCDLAerGBEhCx0JqabCJncwtOfVn4xPi_W14ZM7kGRt-pgl-ftftEP9rVrf_r9aUmRmVCIqlwcSbvwqo-Ce6k0OgFBTwZdW3fQkh---CjcQZQyCo3Isxyf1xU2cgEwIjczNbO_JBbb35wJ7ZhlBTIzSBTaXjYGSTIvbLQ-xp2UGTWzErjfYi818ml2WRmbMrykx3UqeT1PCfwlR7SGiWsib4ltgPwkWg70n_IC9ltN1291Rp9N3-n1n1O31nCbeYq_bbztu72I0HAwcp2fMvV0TP1q_3XbXHTru8MJ1HHc0GrnO7g92VP_S)


[![rt_vs_sched_mermaid](https://mermaid.ink/img/pako:eNqFVG1vmzAQ_iuWpyidlEQhIU1KpUlNm2zqlnZao30YVMiBA7yCjWzTllb57zNQCqjNygewfM9z99wL94w97gO28HA4dJiiKgYL_dqie4luvAj8LAa0ASWoJx1WYnq9Z4chRBlVFiqPCPVVBAn0LdTfEQn9Qfv2NxGU7GKQ_Ve4NqWCJkTk5zzmouB9Ws3Ws_VZTW0QW3hUDWo8Hr-FLLnwQRwCxZTBIZsEjzO_q2O9nq-WLYwCoWgHEgRBvzLvi49-7Xs9hzksiPmDFxGh0HZZAWS2CwVJIyRfilm7RciLiZQXECA_QAGNY-ulBO8gpCdoqmpUKbAIV-PObN2fVN5alqV9DYdfUGMrntWRzVMQRHHh1jp8Vyqi5CjNbz9rXhXhtOEtbRmRFNpOVy3zuS0VTw9ZL0qrq2hy0MHaDlUg3TvIXS5CwugTUZQz1xNcygcS33V4rYRW5dUPu04EFbmjpBrRVxIiYSggJAreqcemIQueKXB9KsArwnf9nNZFBubXx9eGXp2db68rPlJ5qocjpCBbNShUyFRnRWL0l1OGFEe7LAhAgK95xJfvSPtqFxZXQpgAU4db-u3IrqQ3obutLDhdyqVdBX2gKmopbkrWhXekl5yYsxCkQuVgID1QL9m_ifS90taJlDepbE4R-l9l7yGinu5NyiUtmiLbs35l36duJouFcrA41xrz4Vh0KYWTnwXto4GoCS359RUe4AREQqiv12m56RxcbkAHW_roQ0CyWDlYrwsNJZniNznzsKVEBgOcpb6WdUGJLkKCrYDEUt-CT_Vfu6lWdLmpBzglDFvP-BFbw8VkND2ZTk7M6XwxPZkY5gDn2JoejwxztjCPTdOYjRemsR_gJ861V2M0MfQGHBvz6VSjzblZuvtTGsuQ-39p7tDM?type=png)](https://mermaid.live/edit#pako:eNqFVG1vmzAQ_iuWpyidlEQhIU1KpUlNm2zqlnZao30YVMiBA7yCjWzTllb57zNQCqjNygewfM9z99wL94w97gO28HA4dJiiKgYL_dqie4luvAj8LAa0ASWoJx1WYnq9Z4chRBlVFiqPCPVVBAn0LdTfEQn9Qfv2NxGU7GKQ_Ve4NqWCJkTk5zzmouB9Ws3Ws_VZTW0QW3hUDWo8Hr-FLLnwQRwCxZTBIZsEjzO_q2O9nq-WLYwCoWgHEgRBvzLvi49-7Xs9hzksiPmDFxGh0HZZAWS2CwVJIyRfilm7RciLiZQXECA_QAGNY-ulBO8gpCdoqmpUKbAIV-PObN2fVN5alqV9DYdfUGMrntWRzVMQRHHh1jp8Vyqi5CjNbz9rXhXhtOEtbRmRFNpOVy3zuS0VTw9ZL0qrq2hy0MHaDlUg3TvIXS5CwugTUZQz1xNcygcS33V4rYRW5dUPu04EFbmjpBrRVxIiYSggJAreqcemIQueKXB9KsArwnf9nNZFBubXx9eGXp2db68rPlJ5qocjpCBbNShUyFRnRWL0l1OGFEe7LAhAgK95xJfvSPtqFxZXQpgAU4db-u3IrqQ3obutLDhdyqVdBX2gKmopbkrWhXekl5yYsxCkQuVgID1QL9m_ifS90taJlDepbE4R-l9l7yGinu5NyiUtmiLbs35l36duJouFcrA41xrz4Vh0KYWTnwXto4GoCS359RUe4AREQqiv12m56RxcbkAHW_roQ0CyWDlYrwsNJZniNznzsKVEBgOcpb6WdUGJLkKCrYDEUt-CT_Vfu6lWdLmpBzglDFvP-BFbw8VkND2ZTk7M6XwxPZkY5gDn2JoejwxztjCPTdOYjRemsR_gJ861V2M0MfQGHBvz6VSjzblZuvtTGsuQ-39p7tDM)

## Analytic Grains
[![mermaid_grains](https://mermaid.ink/img/pako:eNqNVu9vmzwQ_lcsXlXpK4UKw9q0fJjULiX7sElTV03VSDQ5-Eisgc1s0y2r-r_PxqRxfq3LBwK-55577nw-eAoKQSFIgzAMp1wzXUGKJvfZZ3TNSbXSrFDoE2ugYhzQRBLG1ZR32JOTpylHiHGmU9TdIjTQS6hhkKLBnCgYDP3VL0QyMq9ADV7gxtRIVhO5eicqIa3ff7fn2Xl2vXbdIO7hl96goijah9wISUEeA9kMjtkUFILTbR1ZNrq98TAapGZbkLIsB878bP_M5fnkZMqnvKzEz2JJpEYf7hygqIhSYyiRhEKjklVV2me6Yy-YLCpYIzoNBxjiHpBdZdFtbENaiGrnC0maJVKMLwwJJStnWOeA0HWuiiXQtoIZCsO36BrnUrQaQsosLxN85oEdJM5FA5JoIbdtZ9aY5EqLZraWYH83-SMsmc2iEYpZTuWC3eBcwaIGrpFqAKja-OyICHvcNi_uWchpTqoKacma0EZHPVrN_k_TtK-g70c6x3eY5OTRZLKA1-Mb2m8NYXJmGLuKb7AHFM2PKdpg7-5RZ9GsBl-ozzbvdc5zH420PTb_JqQ4zbvUarLR4OHw9_pI6KIPXeyUCL26R98Y9bQd0ERPTY8ReqAmGB3VQ3s99OiW2fNsRgoNa10WxYsaBT9a4MUr9XLSTPO2tZ0cryY7853jre1RO_vTU_ulGFuHR4W2z974b2dv7CCxO17uIdmh8RvKl9ej1wqA070JYZ1MySQD5QvNDijyrB1xhvNacL3EoZkv2Em7M22niZ2glP0GVzzEybFO74liRxT7RH68OwdLdkVtq980EyUmqhlVqKM92JSTQ7Ns4mbZBOf2AFshiCwWEhaWTwtH12mZJPte8V7N_p2gW-nL6XWYK4uryPsXxaiRwox92Evs0AZ3FH7mDzuT_6HvPq8OD86wNe-9CAgFw6AGWRNGzQdD9w6fBt27fRqk5pZCSdpKTwPzIjRQ0mrxecWLINWyhWFgwi2WQVqSSpmntrHbNWbE6K1fVhvCvwpRr12AMiPjo_tC6T5UOkiQPgW_gjSM3yRnV1F0FWN8cTlKRqNhsDLLF1F0FsUJTvAbjOPzy4vnYfC7Y43PcHR5ESdRPLqM8DlORs9_ANzurn4?type=png)](https://mermaid.live/edit#pako:eNqNVu9vmzwQ_lcsXlXpK4UKw9q0fJjULiX7sElTV03VSDQ5-Eisgc1s0y2r-r_PxqRxfq3LBwK-55577nw-eAoKQSFIgzAMp1wzXUGKJvfZZ3TNSbXSrFDoE2ugYhzQRBLG1ZR32JOTpylHiHGmU9TdIjTQS6hhkKLBnCgYDP3VL0QyMq9ADV7gxtRIVhO5eicqIa3ff7fn2Xl2vXbdIO7hl96goijah9wISUEeA9kMjtkUFILTbR1ZNrq98TAapGZbkLIsB878bP_M5fnkZMqnvKzEz2JJpEYf7hygqIhSYyiRhEKjklVV2me6Yy-YLCpYIzoNBxjiHpBdZdFtbENaiGrnC0maJVKMLwwJJStnWOeA0HWuiiXQtoIZCsO36BrnUrQaQsosLxN85oEdJM5FA5JoIbdtZ9aY5EqLZraWYH83-SMsmc2iEYpZTuWC3eBcwaIGrpFqAKja-OyICHvcNi_uWchpTqoKacma0EZHPVrN_k_TtK-g70c6x3eY5OTRZLKA1-Mb2m8NYXJmGLuKb7AHFM2PKdpg7-5RZ9GsBl-ozzbvdc5zH420PTb_JqQ4zbvUarLR4OHw9_pI6KIPXeyUCL26R98Y9bQd0ERPTY8ReqAmGB3VQ3s99OiW2fNsRgoNa10WxYsaBT9a4MUr9XLSTPO2tZ0cryY7853jre1RO_vTU_ulGFuHR4W2z974b2dv7CCxO17uIdmh8RvKl9ej1wqA070JYZ1MySQD5QvNDijyrB1xhvNacL3EoZkv2Em7M22niZ2glP0GVzzEybFO74liRxT7RH68OwdLdkVtq980EyUmqhlVqKM92JSTQ7Ns4mbZBOf2AFshiCwWEhaWTwtH12mZJPte8V7N_p2gW-nL6XWYK4uryPsXxaiRwox92Evs0AZ3FH7mDzuT_6HvPq8OD86wNe-9CAgFw6AGWRNGzQdD9w6fBt27fRqk5pZCSdpKTwPzIjRQ0mrxecWLINWyhWFgwi2WQVqSSpmntrHbNWbE6K1fVhvCvwpRr12AMiPjo_tC6T5UOkiQPgW_gjSM3yRnV1F0FWN8cTlKRqNhsDLLF1F0FsUJTvAbjOPzy4vnYfC7Y43PcHR5ESdRPLqM8DlORs9_ANzurn4)


|  |  | pipeline and workstream outputs available |
|---|---|---|
| Sampled Wednesdays Each Month for Time-Series<br>[rt_dates.py](../_shared_utils/shared_utils/rt_dates.py) | Mar 2023 - present | downloaded schedule tables (trips, shapes, stops, stop_times)<br>downloaded vehicle positions (vp)<br><br>`gtfs_funnel`: intermediate outputs for schedule and vp<br>* crosswalk<br>* schedule only metrics related to service availability<br>* operator aggregated metrics from schedule data<br>* route typologies<br><br><br>`rt_segment_speeds`: vp interpreted as speeds against <br>various segment types<br>* segment types: <br>(1) `rt_stop_times` (trip-stop segments, most granular, <br>cannot be aggregated, but used for rt_stop_times table)<br>(2) `speedmap segments`<br>(3) `road segments` (1 km road segments with all <br>transit across operators aggregated to the same physical <br>road space, currently WIP)<br>* interpolated stop arrivals <br>* speeds by trip<br>* segment and summary speeds for single day<br><br>`rt_vs_schedule`: <br>* RT vs schedule metrics<br>* rt_stop_times table (companion to scheduled stop_times)<br><br>`gtfs_digest`:<br>* downstream data product using all the outputs created in <br>gtfs_funnel, rt_segment_speeds, rt_vs_schedule. |
| Full Week for Weekly Averages<br>April / October each year | Apr 2023<br>Oct 2023<br>Apr 2024<br>Oct 2024 | rt_segment_speeds:<br>* segment and summary speeds for a week<br><br>gtfs_digest<br>* service hours by hour for weekday / Saturday / Sunday |
|  |  |  |